# GitHub Actions pipeline configuration
name: Build and Test Conan Project using Docker

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Set up Docker
      run: |
        sudo apt-get update
        sudo apt-get install -y docker.io

    - name: Build and Test in Docker Container
      run: |
        docker run --rm -v "${{ github.workspace }}:/workspace" -w /workspace ubuntu:20.04 /bin/bash -c "\
          apt-get update && \
          apt-get install -y python3 python3-pip cmake build-essential && \
          pip3 install --upgrade pip setuptools wheel cython && \
          pip3 install \"conan==2.0.0\" \"pyyaml<=6.0\" && \
          conan profile detect && \
          conan install . --build=missing && \
          mkdir -p build && \
          cd build && \
          cmake .. && \
          cmake --build . && \
          ctest --output-on-failure"
